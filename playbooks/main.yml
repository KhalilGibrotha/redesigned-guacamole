---
# Main Orchestrator Playbook
# Coordinates all the modular playbooks for complete Confluence automation

- name: "ğŸš€ Confluence Documentation Automation - Start"
  hosts: localhost
  connection: local
  gather_facts: true
  vars_files:
    - ../vars/vars.yml

  tasks:
    - name: "ğŸš€ Starting Confluence Documentation Automation"
      ansible.builtin.debug:
        msg: |
          ================================================
          ğŸ“š Confluence Documentation Automation
          ================================================
          Project: {{ project_name }}
          Environment: {{ env }}
          Confluence URL: {{ confluence_url }}
          Space: {{ confluence_space }}
          ================================================

# Repository Sync & Mixed Content Processing
- name: "ğŸ“¦ Repository Sync & Template Processing"
  hosts: localhost
  connection: local
  gather_facts: false
  vars_files:
    - ../vars/vars.yml

  tasks:
    - name: "ğŸ”„ Sync documentation repositories"
      ansible.builtin.command:
        cmd: make sync-repos
        chdir: ".."
      register: sync_result
      
    - name: "ğŸ“ Convert mixed content (templates + markdown)"
      ansible.builtin.command:
        cmd: make convert-mixed-content
        chdir: ".."
      register: convert_result
      
    - name: "ğŸ”„ Convert markdown to HTML"
      ansible.builtin.command:
        cmd: make convert-markdown
        chdir: ".."
      register: html_result

# Enhanced Confluence Publishing
- import_playbook: enhanced_confluence_publishing_clean.yml

- name: "âœ… Confluence Documentation Automation - Complete"
  hosts: localhost
  connection: local
  gather_facts: false
  vars_files:
    - ../vars/vars.yml

  tasks:
    - name: "âœ… Automation Complete"
      ansible.builtin.debug:
        msg: |
          ================================================
          ğŸ‰ Confluence Documentation Automation Complete!
          ================================================

          ğŸ“Š Summary:
          âœ… Environment validated
          âœ… Templates converted to markdown
          âœ… Markdown converted to HTML
          âœ… Content published to Confluence

          ğŸ”— Access your documentation:
          {{ confluence_url }}/spaces/{{ confluence_space }}

          ğŸ§¹ Temporary files automatically cleaned up
          ================================================
